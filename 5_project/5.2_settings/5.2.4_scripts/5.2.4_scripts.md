### 5.2.4 Сценарии в настройках проекта  

[Доступ к разделу ограничен](../../../10_roles_&_access/10.2_access.md).  

В разделе **"Сценарии"** на странице [Настройки проекта](../5.2_settings.md) возможно настроить доступ пользователей проекта к функциям в процессе [редактирования задачи](../../../6_task/6.2_task_page/6.2.1_edit_task/6.2.1_edit_task.md):  

- изменению [статуса](../5.2.2_states/5.2.2_states.md),  
- изменению исполнителя,  
- изменению наблюдателя,
- изменению [тегов](../5.2.3_tags/5.2.3_tags.md).  

Также в разделе поддерживается возможность просмотра **логов** по событиям, которые запустили существующие в проекте сценарии. В логах будут указаны: время действия, тип события, почта пользователя, а также функция сценария и текст ошибки. Над окном вывода логов расположен фильтр по типам:

- "ERROR" - ошибка;

- "PRINT" - логи с выведением информации;

- "SUCCESS" - успешное выполнение скрипта;

- "FAIL" - неуспешное выполнение скрипта.

![логи_фильтр](/imgs/логи_фильтр.jpg)


**Для перехода** в раздел "Сценарии" требуется:  

1. Войти в пространство, к которому относится проект, требующий настройки, выбрав из списка [доступных пространств](../../../4_workspace/4.1_me_workspaces.md) на [панели меню](../../../3_menu/3_menu.md).  
2. В разделе "**Проекты**" на панели меню нажать на значок ![три точки](/imgs/значок_3точки.jpg) рядом с названием конкретного проекта.  
3. Выбрать в открывшемся списке пункт **"Настройки"**.

![project-3](/imgs/project-3.jpg)

4. Нажать на пункт **"Сценарии"** вверху страницы.

![5.2.4-1](/imgs/5.2.4-1.jpg)

**Для создания сценария** требуется ввести в строке справа скрипт на языке lua. Слева на странице есть подсказки для его написания. Обратите внимание, что названия переменных *params* и *newstatus* в функциях можно менять. 

**Ограничения, связанные с параметрами задачи:**

Пример ограничения на изменение любого статуса задачи на статус "Выполнена" для заданного пользователя:

    function BeforeStatusChange(params, new)
      if new.name == "Выполнена" and params:compareUserEmail("example@yandex.ru") then
  	    return { status = false, error = "Ошибка!" }
      end
    end


Если нужно задать ограничение перевода из одного статуса в другой, где оба статуса определены:

    function BeforeStatusChange(params, newstatus)
      if params:compareStatusName("Новая") then
        if newstatus.name == "Выполнена" then 
          return {status = false, error = "Вы не можете перевести задачу в статус "Выполнена"" }
        end
      end
    end


Ограничение на добавление конкретного тега в задачу:

    function BeforeLabelsChange(params, labels)
      if labels:checkName("000") then
        return{status = false, error = 'Ошибка!'}
      end	
        return {status = true}
    end


**Ограничения, связанные с назначенными в задаче пользователями:**

Пример ограничения на добавление заданного пользователя в исполнители:

    function BeforeAssigneesChange(params, members)
      if members:checkEmail("example@yandex.ru")  then
        return {status = false, error = 'Данный пользователь не может быть назначен исполнителем'}
      else
        return {status = true}
      end
    end

Пример ограничения на добавление заданного пользователя в наблюдатели:

    function BeforeWatchersChange(params, members)
      if members:checkEmail("example@yandex.ru")  then
        return {status = false, error = 'Данный пользователь не может быть назначен наблюдателем'}
      else
        return {status = true}
      end
    end
